<!DOCTYPE html>
<html>

<body>

    <h2>Formulário Agricultura 4.0</h2>

    <form id="myForm">
        <label for="tamanho"> Tamanho da lavoura: </label><br>
        <input type="number" id="Tamx"><br>
        <input type="number" id="Tamy"><br>
        <label for="sensorId">ID do Sensor:</label><br>
        <input type="text" id="sensorId" name="sensorId"><br>
        <label for="sensorDesc">Descrição do Sensor:</label><br>
        <input type="text" id="sensorDesc" name="sensorDesc"><br>
        <label for="sensorLat">Latitude do Sensor:</label><br>
        <input type="text" id="sensorLat" name="sensorLat"><br>
        <label for="sensorLong">Longitude do Sensor:</label><br>
        <input type="text" id="sensorLong" name="sensorLong"><br>
        <label for="bombaId">ID da Bomba:</label><br>
        <input type="text" id="bombaId" name="bombaId"><br>
        <label for="bombaDesc">Descrição da Bomba:</label><br>
        <input type="text" id="bombaDesc" name="bombaDesc"><br>
        <input type="button" value="Controle Automático" onclick="controleAutomatico()">
        <label for="mediaSensores">Média dos Sensores:</label><br>
        <input type="text" id="mediaSensores" name="mediaSensores" readonly><br>
        <label for="bombaStatus">Status da Bomba:</label><br>
        <input type="text" id="bombaStatus" name="bombaStatus" readonly><br>
        <label for="buscaId">ID para Buscar:</label><br>
        <input type="text" id="buscaId" name="buscaId"><br>
        <input type="button" value="Buscar por ID" onclick="buscarPorId()">
        <textarea id="resultadoBusca"></textarea>
    </form>

    <script>
        class Sensor {
            constructor(id, descricao) {
                this.id = id;
                this.descricao = descricao;
                this.valorLeitura = 0;
            }

            ler() {
                // Aqui você pode adicionar a lógica para alterar os dados do sensor
                this.valorLeitura = Math.random(); // Valor aleatório para exemplo
            }
        }

        class SensorGeorreferenciado extends Sensor {
            constructor(id, descricao, latitude, longitude) {
                super(id, descricao); // Aqui usamos 'super' para chamar o construtor da classe pai
                this.latitude = latitude;
                this.longitude = longitude;
            }

            // Aqui estamos sobrescrevendo o método 'ler' da classe pai para adicionar funcionalidade georreferenciada
            ler() {
                super.ler(); // Aqui usamos 'super' para chamar o método 'ler' da classe pai
                console.log(`Leitura do sensor georreferenciado na latitude ${this.latitude} e longitude ${this.longitude}`);
            }
        }

        class Bomba {
            constructor(id, descricao) {
                this.id = id;
                this.descricao = descricao;
                this.status = 'desligada';
            }

            ligar() {
                this.status = 'ligada';
            }

            desligar() {
                this.status = 'desligada';
            }
        }
        var localiza;
        var sensores = []; // array para armazenar os objetos do sensor
        function georreferenciado() {
            var sensorId = document.getElementById("sensorId").value;
            var sensorDesc = document.getElementById("sensorDesc").value;
            var sensorLat = document.getElementById("sensorLat").value;
            var sensorLong = document.getElementById("sensorLong").value;
            var posx = document.getElementById("Tamx").value;
            var posy = document.getElementById("Tamy").value;
            var sensor = new SensorGeorreferenciado(sensorId, sensorDesc, sensorLat, sensorLong);
            var soma = sensor.latitude - sensor.longitude; //para saber o tamanho total da area
            if (sensor.latitude > posx || sensor.longitude > posy) {
                alert("O sensor está fora da área de plantio");
            }
            if (sensor.latitude < posx || sensor.longitude < posy) 
            {
                //quero saber a distancia que o sensor esta da borda
                var distanciax = posx - sensor.latitude + posy - sensor.longitude;
                localiza = distanciax;
            }
            function controleAutomatico() {
                var sensorId = document.getElementById("sensorId").value;
                var sensorDesc = document.getElementById("sensorDesc").value;
                var sensorLat = document.getElementById("sensorLat").value;
                var sensorLong = document.getElementById("sensorLong").value;
                var bombaId = document.getElementById("bombaId").value;
                var bombaDesc = document.getElementById("bombaDesc").value;


                sensores = [
                    new Sensor(sensorId, sensorDesc),
                    new SensorGeorreferenciado(sensorId, sensorDesc, sensorLat, sensorLong),
                ];

                var bomba = new Bomba(bombaId, bombaDesc);

                var totalLeitura = 0;

                for (var i = 0; i < sensores.length; i++) {
                    sensores[i].ler();
                    totalLeitura += sensores[i].valorLeitura;
                }

                var mediaLeitura = totalLeitura / sensores.length;

                if (mediaLeitura > 0.5) {
                    bomba.ligar();
                } else {
                    bomba.desligar();
                }

                document.getElementById("mediaSensores").value = mediaLeitura.toFixed(2);
                document.getElementById("bombaStatus").value = bomba.status;
            }
            function buscarPorId() {
                var buscaId = document.getElementById("buscaId").value;
                var indiceSensorEncontrado = sensores.findIndex(function (sensor) {
                    return sensor.id === buscaId;
                });

                if (indiceSensorEncontrado !== -1) {
                    document.getElementById("resultadoBusca").innerHTML = JSON.stringify(sensores[indiceSensorEncontrado], null, 2);
                } else {
                    document.getElementById("resultadoBusca").innerHTML = "Sensor não encontrado";
                }
            }

    </script>

</body>

</html>