<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agricutura 4.0</title>
</head>

<body>
    <form id="agriculturaForm">
        <label for="idSensor">ID do Sensor:</label><br>
        <input type="text" id="idSensor" name="idSensor"><br>
        <label for="descricao">Descrição do Sensor:</label><br>
        <input type="text" id="descricaoSensor" name="descricaoSensor"><br>
        <label for="valordosensor"> Valor do sensor: </label> <br>
        <input type="text" name="valordaleitura" id="valorLeitura"><br>
        <label for="latitude">Latitude:</label><br>
        <input type="text" id="latitude" name="latitude"><br>
        <label for="longitude">Longitude:</label><br>
        <input type="text" id="longitude" name="longitude"><br>
        <input type="button" value="Inicializar Sensor Georreferenciado"
            onclick="inicializarSensorGeoreferenciado()"><br><br>
        <label for="idBomba">ID da Bomba:</label><br>
        <input type="text" id="idBomba" name="idBomba"><br>
        <label for="descricaoBomba">Descrição da Bomba:</label><br>
        <input type="text" id="descricaoBomba" name="descricaoBomba"><br>
        <input type="button" value="Inicializar Bomba" onclick="inicializarBomba()"><br><br>

        <input type="button" value="Ler Sensor" onclick="lerSensor()">
        <input type="button" value="Visualizar Cenário" onclick="visualizarCenario()">

        <ul id="listaCenario"></ul>

        <div>
            <label for="idPesquisa">ID para Pesquisa:</label><br>
            <input type="text" id="idPesquisa" name="idPesquisa"><br>
            <input type="button" value="Pesquisar por ID"
                onclick="pesquisarPorId(document.querySelector('#idPesquisa').value)"><br><br>

            <div id="resultadoPesquisa"></div>
        </div>
    </form>
</body>


<script>
    class Sensor {
        constructor(id, descricao, valorLeitura) {
            this.id = id;
            this.descricao = descricao;
            this.valorLeitura = valorLeitura;
        }
    }

    class Bomba {
        constructor(id, descricao, status) {
            this.id = id;
            this.descricao = descricao;
            this.status = status; // true para ligada, false para desligada
        }

        ligar() {
            this.status = true;
        }

        desligar() {
            this.status = false;
        }
    }

    class SensorGeoreferenciado extends Sensor {
        constructor(id, descricao, valorLeitura, latitude, longitude) {
            super(id, descricao, valorLeitura);
            this.latitude = latitude;
            this.longitude = longitude;
        }
    }

    var sensores = []; // array para armazenar os objetos do sensor
    var bombas = []; // array para armazenar as bombas

    function controleAutomatico() {
        setInterval(lerSensor, 1000); // lê o sensor a cada segundo
    }

    function inicializarSensorGeoreferenciado() {
        var id = document.querySelector("#idSensor").value;
        var descricao = document.querySelector("#descricaoSensor").value;
        var latitude = document.querySelector("#latitude").value;
        var longitude = document.querySelector("#longitude").value;
        var sensor = new SensorGeoreferenciado(id, descricao, 0, latitude, longitude);

        // Verifica a soma da latitude e da longitude
        var soma = latitude + longitude;

        // Liga ou desliga o sensor
        if (soma < 10) {
            sensor.ligar();
        } else if (soma >= 10 && soma < 30) {
            sensor.desligar();
        }

        sensores.push(sensor); // adiciona o novo objeto ao array
    }


    // Função para inicializar o sensor com os dados do formulário
    //function inicializarSensor() {
    //  var id = document.querySelector("#idSensor").value;
    //var descricao = document.querySelector("#descricaoSensor").value;
    //var valor = document.querySelector("#valorLeitura").value;
    //var sensor = new Sensor(id, descricao, valor);
    //sensores.push(sensor); // adiciona o novo objeto ao array
    //}

    // Função para inicializar a bomba com os dados do formulário
    function inicializarBomba() {
        var id = document.querySelector("#idBomba").value;
        var descricao = document.querySelector("#descricaoBomba").value;
        var bomba = new Bomba(id, descricao, false); // inicializa a bomba
        bombas.push(bomba); // adiciona a nova bomba ao array
    }

    // Função para ler o sensor e atualizar a interface do usuário
    function lerSensor() {
        var total = 0;
        for (var i = 0; i < sensores.length; i++) {
            total += sensores[i].valorLeitura;
        }

        var media = total / sensores.length;

        if (media < 5) { // supondo que 5 seja o valor mínimo de umidade
            for (var i = 0; i < bombas.length; i++) {
                bombas[i].ligar();
                document.querySelector("#statusBomba" + i).textContent = "Ligada";
            }

        } else {
            for (var i = 0; i < bombas.length; i++) {
                bombas[i].desligar();
                document.querySelector("#statusBomba" + i).textContent = "Desligada";
            }

        }
    }

    // Função para atualizar a interface do usuário com os dados do cenário
    function visualizarCenario() {

        // Cria uma nova lista
        var listaCenario = document.createElement("ul");

        // Adiciona os dados do cenário à lista
        for (var i = 0; i < bombas.length; i++) {
            var item = document.createElement("li");
            item.textContent = `
                ID da bomba: ${bombas[i].id}
                Status: ${bombas[i].status ? "Ligada" : "Desligada"}
                Descrição: ${bombas[i].descricao}
                ID do Sensor: ${sensores[i].id}
                Descrição do Sensor: ${sensores[i].descricao}
                Valor do Sensor: ${sensores[i].valorLeitura}
                Latitude: ${sensores[i].latitude}
                Longitude: ${sensores[i].longitude}
            `;
            listaCenario.appendChild(item);
        }

        // Adiciona a lista à interface do usuário
        document.querySelector("#listaCenario").appendChild(listaCenario);
    }


    // Função para pesquisar por ID dentro dos vetores e mostrar se encontrar
    // Função para pesquisar por ID dentro dos vetores e mostrar se encontrar
    function pesquisarPorId(id) {

        for (var i = 0; i < sensores.length; i++) {
            if (sensores[i].id == id) {
                document.querySelector("#resultadoPesquisa").textContent = "Sensor encontrado: " + JSON.stringify(sensores[i]);
                return;
            }
        }

        for (var i = 0; i < bombas.length; i++) {
            if (bombas[i].id == id) {
                document.querySelector("#resultadoPesquisa").textContent = "Bomba encontrada: " + JSON.stringify(bombas[i]);
                return;
            }
        }

        document.querySelector("#resultadoPesquisa").textContent = "Nenhum sensor ou bomba encontrado com o ID: " + id;

    }


</script>

</html>